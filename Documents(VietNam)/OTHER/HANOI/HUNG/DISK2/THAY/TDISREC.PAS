{$A+,B-,D+,E+,F-,G-,I-,L+,N-,O-,P-,Q+,R+,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}
program Problem1;
uses crt;
const
   fin: string ='DISREC.IN0';
   fou: string ='DISREC.OUT';
   dapso: array['0'..'9'] of longint=
    ( 282016, 1, 2, 4, 246, 243, 4646, 5712, 8184, 31829);

Type integer = longint;
var
             list : array [1..5000] of record
                                          x, y : integer;
                                       end;
             i, j : integer;
stx,l,  sty,x, y  : integer;
   dp, cur, n, m  : integer;
           aa, qq : integer;
 	        x1, y1 : integer;
                f : text;
             chon : char;
             diem : integer;

Function Dist(xx, yy : integer) : integer;
begin
    Dist := sqr(XX-x)+sqr(yy-y);
end;

function min(x, y : integer) : integer;
begin
   if x < y then min := x else min := y;
end;


Function Distance(xx, yy : integer) : integer;
var
   q : integer;
begin
   q := min(dist(xx, yy), dist(xx+m, yy));
   q := min(q, dist(xx+m, yy+n));
   q := min(q, dist(xx, yy+n));
   if stx=xx then q := min(sqr(yy-y), sqr(yy+n-y));
   if sty=yy then q := min(sqr(xx-x), sqr(xx+m-x));
   if (stx=xx) and (sty=yy) then q := 0;
   distance := q;
end;


procedure Cham;
begin
   diem:=0;
   assign(f, fin); reset(f);
   read(f, m, n, L, x, y);
   close(f);
   stx := x div m; if stx*m > x then dec(stx); stx := stx * m;
   sty := y div n; if sty*n > y then dec(sty); sty := sty * n;
   assign(f, fou); reset(f);
   aa:= dapso[chon];
   dp := 0; cur := 0;
   for j := 1 to AA do
   begin
     if seekeof(f) then
     begin
        writeln('?????????????????????????????????????????????');
        writeln('              Loi: Khong du hinh! ');
        writeln('?????????????????????????????????????????????');
        exit;
     end;
     readln(f,x1,y1);
     if distance(x1, y1)<dp then
     begin
        writeln('?????????????????????????????????????????????');
        writeln('          Loi: Khong dung thu tu! ');
        writeln('?????????????????????????????????????????????');
        exit;
     end;
     if distance(x1, y1)>l*l then
     begin
        writeln('?????????????????????????????????????????????');
        writeln('     Loi: Khoang cach khong nho hon ',L);
        writeln('?????????????????????????????????????????????');
        exit;
     end;
     if distance(x1, y1)=dp then
     begin
       for i := 1 to cur do
         if (list[i].x=x1) and (list[i].y=y1) then
         begin
            writeln('?????????????????????????????????????????????');
            writeln('     Loi: Lap lai hinh! ');
            writeln('?????????????????????????????????????????????');
            exit;
         end;
     end;
     if distance(x1, y1)>dp then cur := 0;
     dp := distance(x1, y1);
     inc(Cur); list[cur].x := x1; list[cur]. y := y1;
     inc(qq);
   end;
   if not seekeof(f) then
   begin
      writeln('?????????????????????????????????????????????');
      writeln('              Loi: Thua hinh! ');
      writeln('?????????????????????????????????????????????');
      exit;
   end;
   writeln('###############################################');
   writeln('                C O R R E C T !');
   writeln('###############################################');
   diem:=1;
end;


BEGIN
    clrscr;
    writeln('                       CHUONG TRINH CHAM BAI: DISREC');
    writeln('                     ==================================');
    write  ('                        Cho ten file test: DISREC.IN');
    chon:=readkey; writeln(chon);
    Fin := 'DISREC.IN'+chon;
    writeln; writeln; writeln;
    Cham;
    writeln; writeln;
    writeln('                   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    writeln('                              Diem: ', diem);
    writeln('                   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    readln;
END.
