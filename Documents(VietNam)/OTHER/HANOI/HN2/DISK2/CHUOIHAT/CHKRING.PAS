{$A+,B-,D+,E+,F-,G+,I+,L+,N+,O+,P-,Q-,R-,S+,T-,V-,X+,Y+}
{$M 60000,0,655360}
program Chuoihat;
uses crt;

const
   fin: string = 'CHUOIHAT.IN1';
   fou: string = 'CHUOIHAT.OUT';

type
    arr = array [1..100,1..100] of longint;

var N, K   : integer;
    Names  : array [1..100] of string;
    Prices : array [1..100] of extended;
    Sets   : ^arr;
    i,j,l  : integer;
    CurPrice : extended;
    TotPrice : extended;
    CurQua   : extended;
    TotQua   : extended;
    s,s1,s2  : string;
    ind      : integer;
    qua      : integer;
    chon     : char;
    f        : text;
    diem     : integer;


function Readword(s: string): string;
var i: integer;
begin
    i:= pos(' ', s);
    readword:= copy(s,1,i-1);
end;

function ReadInteger(s: string): extended;
var i, code: integer;
    tg: longint;
begin
    i:= pos(' ', s);
    val(copy(s,i+1,length(s)-i),tg,code);
    readInteger:= tg;
end;


function FindIndex(s : string) : integer;
var cur : integer;
begin
  cur := k;
  while (cur > 0) and (pos(s, Names[cur]) = 0) do Dec(cur);
  FindIndex := cur;
end;

procedure Check;
var
     s, so: string;
     tt: char;
     code: integer;
begin
   diem:=0;
   assign(f,fin); reset(f);
   readln(f,N);
   readln(f,K);
   for i := 1 to K do
   begin
     readln(f,s);
     Names [i] := ReadWord(s);
     Prices [i] := ReadInteger(s);
   end;
   close(f);

   assign(f,fou); reset(f);

   if (chon ='2') or (chon = '3') then
   begin
       readln(f,s);
       if s<>'NO SOLUTION.' then
       begin
          writeln('??????????????????????????????????????????');
          writeln('    ERROR: Can thong bao NO SOLUTION.' );
          writeln('??????????????????????????????????????????');
       end
       else
       begin
          writeln('##########################################');
          writeln('            C  O  R  R  E  C  T ');
          writeln('##########################################');
          diem:= 1;
       end;
       exit;
   end;
   for i := 1 to 100 do
      for j:= 1 to 100 do  Sets ^[i, j] := 0;

   for l := 1 to N do
   begin
       writeln('#####  Check GIRL: ',l);
       if seekeof(f) then
       begin
          writeln('??????????????????????????????????????????');
          writeln('        FILE Output ghi thieu ');
          writeln('??????????????????????????????????????????');
          exit;
       end;
       tt:=' ';
       repeat
         if not seekEoln(f) then
         begin
           while tt = ' ' do  Read(f,tt);
           s:=tt;
           while (tt <> ' ') do
           begin
              Read(f,tt);
              if tt <> ' ' then s:= s+tt;
           end;
           ind := FindIndex(s);
           if ind = 0 then
           begin
             writeln('??????????????????????????????????????????');
             writeln('    ERROR: Khong co ten loai da: ',s);
             writeln('??????????????????????????????????????????');
             exit;
           end;
           read(f,qua);
           Sets^[l,ind] := Sets^[l,ind] + qua;
         end;
       until seekEoln(f);
       readln(f);
     end;

     TotPrice := -1;
     TotQua := -1;
     for i := 1 to N do
     begin
       CurPrice := 0;
       CurQua := 0;
       for j := 1 to K do
       begin
          CurPrice:= CurPrice+Sets^[i,j]*Prices[j];
          CurQua := CurQua + Sets^[i,j];
       end;

       if TotPrice = -1 then TotPrice := CurPrice;
       if TotQua   = -1 then TotQua   := CurQua;

       if TotQua = 0 then
       begin
         writeln('??????????????????????????????????????????');
         writeln('          ERROR: So luong 0 ? ');
         writeln('??????????????????????????????????????????');
         exit;
       end;

       if CurQua <> TotQua then
       begin
         writeln('??????????????????????????????????????????');
         writeln('      ERROR: So luong khong bang nhau? ');
         writeln('??????????????????????????????????????????');
         exit;
       end;

       if CurPrice <> TotPrice then
       begin
         writeln('??????????????????????????????????????????');
         writeln('      ERROR: Gia tri khong bang nhau? ',i);
         writeln('      Cur = ',curPrice:20:0);
         writeln('      toP = ',totPrice:20:0);
         writeln('??????????????????????????????????????????');
         exit;
       end;
     end;

     for i := 1 to N do
       for j := i+1 to N do
         begin
           l := K;
           while (Sets^[i,l] = Sets^[j,l]) and (l > 0) do Dec(l);
           if L = 0 then
           begin
              writeln('??????????????????????????????????????????');
              writeln('      ERROR: Hai bo qua giong nhau? ');
              writeln('??????????????????????????????????????????');
              exit;
           end;
         end;
    writeln('##########################################');
    writeln('            C  O  R  R  E  C  T ');
    writeln('##########################################');
    diem:= 1;
end;


BEGIN
   New(Sets);
    clrscr;
    writeln('                       CHUONG TRINH CHAM BAI: CHUOI HAT');
    writeln('                     ===================================');
    write  ('                       Cho ten file test: CHUOIHAT.IN');
    chon:=readkey; writeln(chon);
    Fin := 'CHUOIHAT.IN'+chon;
    writeln; writeln; writeln;
    Check;
    writeln; writeln;
    writeln('                   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    writeln('                              Diem: ', diem);
    writeln('                   $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    readln;
END.



