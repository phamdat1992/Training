{$A+,B-,D+,E+,F-,G-,I+,L+,N+,O-,P-,Q-,R+,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}
uses crt;
const
   finp: string = 'SIGN.IN';
   fout =  'SIGN.OUT';
var
   chon: char;
   st: String;
   BestFloor:  array [1..500] of LongInt;
   CurrentFloor: array [1..500] of LongInt;
   diem: integer;

procedure Cham;
var
   i, j, n, m, x, y: LongInt;
   err: Integer;
   tstf, inf, resf: Text;
   BestSum: LongInt;
   CurrentSum, tg: LongInt;
begin
    diem:=0;
    FillChar(BestFloor, SizeOf(BestFloor), 0);
    Assign(inf, finp);
    Assign(tstf, fout);
    {$I-}
    Reset(tstf);  Close(tstf);
    {$I+}
    if (IOResult <> 0) then
    begin
        writeln('?????????????????????????????????????????????');
        Writeln('        Error: File SIGN.OUT not found');
        writeln('?????????????????????????????????????????????');
        Flush(resf);
        exit;
    end;
    Reset(inf);
    Readln(inf, m, n);
    i := 0;   y := 0;
    Reset(tstf); readln(tstf,tg,tg);
    while NOT EOF(tstf) do
    begin
        readln(tstf, st);
        if (length(st)=0) then
        begin
            writeln('?????????????????????????????????????????????');
            Writeln('            Error:  Empty Row ');
            writeln('?????????????????????????????????????????????');
            Close(tstf);  Close(inf);
            exit;
        end;
        if (st[1]='0') then
        begin
            writeln('?????????????????????????????????????????????');
            Writeln('        Error 3: Incorrect Zero');
            writeln('?????????????????????????????????????????????');
            Close(tstf);  Close(inf);
            exit;
        end;
        for j:=1 to length(st) do
          if NOT(st[j] in ['0'..'9']) then
          begin
              writeln('?????????????????????????????????????????????');
              Writeln('      Error: Invalid numeric format');
              writeln('?????????????????????????????????????????????');
              Close(tstf);  Close(inf);
              exit;
          end;
        if (length(st)>3) then
        begin
            writeln('?????????????????????????????????????????????');
            Writeln('        Error: Invalid index of Chambers');
            writeln('?????????????????????????????????????????????');
            Close(tstf);  Close(inf);
            exit;
        end;
        val(st, x, err);
        if (x<1)OR(x>n) then
        begin
            writeln('?????????????????????????????????????????????');
            Writeln('      Error: Invalid index of Chambers');
            writeln('?????????????????????????????????????????????');
            Close(tstf);  Close(inf);
            exit;
        end;
        if (ABS(y-x)>1)AND(y<>0) then
        begin
            writeln('?????????????????????????????????????????????');
            Writeln('      Error:  Khong di sang phong ke');
            writeln('?????????????????????????????????????????????');
            Close(tstf);  Close(inf);
            exit;
        end;
        if (x=y)OR(y=0) then Inc(i);
        y := x;
    end;
    if (i<>m) then
    begin
        writeln('?????????????????????????????????????????????');
        Writeln('         Error: Khong ket thuc o tang ',m);
        writeln('?????????????????????????????????????????????');
        Close(tstf);  Close(inf);
        exit;
    end;
    CurrentSum := 0;
    Reset(tstf);;read(tstf,tg,tg);
    Readln(tstf, x);
    y := 0;
    for i:=1 to m do
    begin
        for j:=1 to n do
        begin
            Read(inf, CurrentFloor[j]);
            Inc(BestFloor[j], CurrentFloor[j]);
        end;
        Readln(inf);
        for j:=2 to n do
          if (BestFloor[j-1]+CurrentFloor[j] < BestFloor[j]) then
            BestFloor[j] := BestFloor[j-1] + CurrentFloor[j];
        for j:=n-1 downto 1 do
          if (BestFloor[j+1]+CurrentFloor[j] < BestFloor[j]) then
            BestFloor[j] := BestFloor[j+1] + CurrentFloor[j];
        Inc(CurrentSum, CurrentFloor[x]);
        while NOT EOF(tstf) do
        begin
            y := x;
            Readln(tstf, x);
            if (x=y) then
              break
            else
              Inc(CurrentSum, CurrentFloor[x]);
        end;
    end;
    Close(inf);
    BestSum := BestFloor[1];
    for i:=2 to n do
      if (BestFloor[i] < BestSum) then   BestSum := BestFloor[i];
    if (BestSum<CurrentSum) then
    begin
        writeln('?????????????????????????????????????????????');
        Writeln('       Error: Ket qua khong toi uu: ', CurrentSum,
                                   ' dang ra la ',BestSum);
        writeln('?????????????????????????????????????????????');
        Close(tstf);
        exit;
    end;
    writeln;
    writeln('$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    Writeln('         C O R R E C T!  C O R R E C T!');
    writeln('$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
    Close(tstf);
    diem:=1;
end;

BEGIN
    clrscr;
    writeln;
    writeln('            ===============================================');
    writeln('                            Cham bai SIGN');
    writeln('            ===============================================');
    write  ('                    Cho ten file test: SIGN.IN');chon:=readkey;
    finp:='SIGN.IN'+chon; writeln(chon);
    writeln;
    Cham;
    writeln;
    writeln;
    writeln('                   =============================');
    writeln('                              Diem: ',diem);
    writeln('                   =============================');
    readln;
END.