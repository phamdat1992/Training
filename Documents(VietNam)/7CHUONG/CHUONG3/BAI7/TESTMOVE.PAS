{  Test TMOVE }
{$R+}
{$M 60384,0,655360}

Uses  Crt;
Const
      inp: string = 'TMOVE.INP';
      out       = 'TMOVE.OUT';
      nmax = 101;
      dapso: array['1'..'7'] of integer = ( 8, 7, 25, 42, 58, 78, 6);

Type  arr        = array[0..nmax,0..nmax] of char;
      arr1       = array[0..10000] of byte;

Var
      F     : Text;
      N, M  : longint;
      a     : arr;
      rowG, colG: array[1..3] of integer;
      dirG  : integer;
      rowT, colT: array[1..3] of integer;
      dirT  : integer;
      tong  : longint;
      chon  : char;
      diem  : real;

Procedure Cham;
Var i,j  : integer;
    t, t1: integer;
    tchon: char;
Begin
    diem:=0;
    fillchar(a, sizeof(a),0);
    Assign(f,inp); Reset(f);
    readln(f,n);
    for i:=1 to n do
    begin
        a[0,i]:='1';
        a[i,0]:='1';
        a[i,n+1]:='1';
        a[n+1,i]:='1';
    end;
    for i:=1 to n do
    begin
       for j:=1 to n do read(f,a[i,j]);
       readln(f);
    end;
    Close(f);
    t:=0; t1:=0;
    for i:=1 to n do
       for j:=1 to n do
       begin
          if a[i,j]='b' then
          begin
             t:=t+1;
             rowG[t]:=i; colG[t]:=j
          end;
          if a[i,j]='e' then
          begin
             t1:=t1+1;
             rowT[t1]:=i; colT[t1]:=j
          end;
       end;
    if rowG[1]=rowG[2] then dirG:=1 else dirG:=2;
    if rowT[1]=rowT[2] then dirT:=1 else dirT:=2;
    Assign(f,out); Reset(f);
    Readln(f,tong);
    if (tong<>dapso[chon]) then
    begin
        writeln('???????????????????????????????????????????????????');
        writeln('         ERROR: Sai dap so!');
        writeln('                So buoc tim duoc: ',tong);
        writeln('                Dap so          : ',dapso[chon]);
        writeln('???????????????????????????????????????????????????');
        exit;
    end;
   for i:=1 to tong do
   begin
       read(f,tchon);
       if not (tchon in ['L','R','D','U','T']) then
       begin
           writeln('???????????????????????????????????????????????????');
           writeln('         ERROR: Khong co kieu di chuyen: ',tchon);
           writeln('???????????????????????????????????????????????????');
           exit;
       end;
       case tchon of
           'L':   begin
                       if dirG=1 then
                       begin
                           if (a[rowG[1],colG[1]-1]='1') then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen sang trai duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do colG[j]:=colG[j]-1;
                       end
                       else
                       begin
                           if (a[rowG[1],colG[1]-1]='1') or
                              (a[rowG[2],colG[2]-1]='1') or
                              (a[rowG[3],colG[3]-1]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen sang trai duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do colG[j]:=colG[j]-1;
                       end;
                  end;
           'R':   begin
                       if dirG=1 then
                       begin
                           if (a[rowG[3],colG[3]+1]='1') then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen sang phai duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do colG[j]:=colG[j]+1;
                       end
                       else
                       begin
                           if (a[rowG[1],colG[1]+1]='1') or
                              (a[rowG[2],colG[2]+1]='1') or
                              (a[rowG[3],colG[3]+1]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen sang phai duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do colG[j]:=colG[j]+1;
                       end;
                  end;
           'U':   begin
                       if dirG=1 then
                       begin
                           if (a[rowG[1]-1,colG[1]]='1') or
                              (a[rowG[2]-1,colG[2]]='1') or
                              (a[rowG[3]-1,colG[3]]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen len tren duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do rowG[j]:=rowG[j]-1;
                       end
                       else
                       begin
                           if (a[rowG[1]-1,colG[1]]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen len tren duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do rowG[j]:=rowG[j]-1;
                       end;
                  end;
           'D':   begin
                       if dirG=1 then
                       begin
                           if (a[rowG[1]+1,colG[1]]='1') or
                              (a[rowG[2]+1,colG[2]]='1') or
                              (a[rowG[3]+1,colG[3]]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen xuong duoi duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do rowG[j]:=rowG[j]+1;
                       end
                       else
                       begin
                           if (a[rowG[3]+1,colG[1]]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong di chuyen xuong duoi duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           for j:=1 to 3 do rowG[j]:=rowG[j]+1;
                       end;
                  end;

           'T':   begin
                       if dirG=1 then
                       begin
                           if (a[rowG[1]+1,colG[1]]='1') or
                              (a[rowG[2]+1,colG[2]]='1') or
                              (a[rowG[3]+1,colG[3]]='1') or
                              (a[rowG[1]-1,colG[1]]='1') or
                              (a[rowG[2]-1,colG[2]]='1') or
                              (a[rowG[3]-1,colG[3]]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong quay duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           rowG[1]:=rowG[1]-1; colG[1]:=colG[2];
                           rowG[3]:=rowG[3]+1; colG[3]:=colG[2];
                           dirG:=2;
                       end
                       else
                       begin
                           if (a[rowG[1],colG[1]+1]='1') or
                              (a[rowG[2],colG[2]+1]='1') or
                              (a[rowG[3],colG[3]+1]='1') or
                              (a[rowG[1],colG[1]-1]='1') or
                              (a[rowG[2],colG[2]-1]='1') or
                              (a[rowG[3],colG[3]-1]='1')
                           then
                           begin
                              writeln('???????????????????????????????????????????????????');
                              writeln('         ERROR: Khong quay duoc! ');
                              writeln('                Loi o buoc: ', i);
                              writeln('???????????????????????????????????????????????????');
                              exit;
                           end;
                           rowG[1]:=rowG[2]; colG[1]:=colG[2]-1;
                           rowG[3]:=rowG[2]; colG[3]:=colG[2]+1;
                           dirG:= 1;
                       end;
                  end;
       end;
   end;
   close(f);
   if dirG<>dirT then
   begin
      writeln('???????????????????????????????????????????????????');
      writeln('     ERROR: Ghe khong chuyen den vi tri dich! ');
      writeln('???????????????????????????????????????????????????');
      exit;
   end;
   for i:=1 to 3 do
     if (rowG[i]<>rowT[i]) or (colG[i]<>colT[i]) then
     begin
        writeln('???????????????????????????????????????????????????');
        writeln('     ERROR: Ghe khong chuyen den vi tri dich! ');
        writeln('???????????????????????????????????????????????????');
        exit;
     end;
   diem:=1.5;
   if chon='5' then diem:=2;
   if chon='1' then diem:=1;
   if chon='2' then diem:=1;
   writeln('$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
   writeln('       C O R R E C T ! C O R R E C T !');
   writeln('$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$');
End;

Begin
   Clrscr;
   writeln('            ===========================================');
   writeln('                  CHUONG TRINH CHAM BAI TMOVE');
   writeln('            ===========================================');
   write  ('                  Cho ten file test: TMOVE.IN');
   chon:=readkey; writeln(chon);
   inp:= 'TMOVE.IN'+chon;
   writeln; writeln;
   Cham;
   writeln; writeln;
   writeln('            ====================================');
   writeln('                       Diem: ',diem:3:1);
   writeln('            ====================================');
   readln;
End.
